<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Headings -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  <!-- Body -->
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="../assets/prism/prism-okaidia-1.29.0.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/global-min.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/text-min.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/nav-min.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/headings-min.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/martech-article-min.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/footer-min.css">
  
  <title>MarTech | Adobe Launch Global Clicks or Events Tracking</title>

  <meta name="Author" content="Todd Croak-Falen">
  <meta name="Description" content="MarTech Adobe Launch Global Clicks or Events Tracking.">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="../favicon.ico">
  <meta name="msapplication-config" content="browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

</head>

<body class="body line-numbers">

  <div class="body__project-container">

    <nav class="nav">
      <div class="center__1140 nav__flex">
        <a href="/" class="nav__flex_link font_size_1">
          <div class="nav__flex_text"><i class="fas fa-home nav__flex_icon"></i>Home</div>
        </a>
        <a href="../about-me" class="nav__flex_link font_size_1">
          <div class="nav__flex_text"><i class="fas fa-user-circle nav__flex_icon"></i>About Me</div>
        </a>
        <!-- <a href="../resume_todd_croak-falen.pdf" target="_blank" class="nav__flex_link font_size_1">
          <div class="nav__flex_text"><i class="fas fa-file-alt nav__flex_icon"></i>Résumé</div>
        </a> -->
      </div> <!-- Close .nav__flex -->
    </nav>

    <main class="main content-top">

      <header class="header">
        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h1 class="heading__title-tag font_size_4">
              <span class="heading__title-tag_title">Adobe Launch Global Clicks or Events Tracking</span>
            </h1>
          </div>
        </div>
        <div class="martech-header__img martech-header__img_swimming-pool-water-overhead"></div>
      </header>

      <section>

        <div class="heading heading_theme_black">
          <div class="heading__title-overflow">
            <h2 class="heading__title-tag font_size_3">
              <span class="heading__title-tag_title">Overview</span>
            </h2>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">
          
            <p class="main__text font_size_body">At my company, there is a core set of tracking events and variables we send to Adobe Analytics for all events.</p>

            <p class="main__text font_size_body">For the purposes of this explanation, let&rsquo;s say I work at a solar power company. (All variables and attributes in this article have been changed to suit that scenario.) To keep things D.R.Y., this core set of variables is programmed into one Adobe Launch rule named <code class="code__name">Global | Set Variables | Clicks or Events #25</code>, which fires on every event we want to track.</p>

            <p class="main__text font_size_body">In addition to those baseline variables, if that event is a click, we also send:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">event1: Custom Link Click (increment)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">eVar1: Custom Link Value (describes which element was clicked)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">prop1: Custom Link Value (same value as eVar1)</p>
              </li>
            </ul>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Basic Custom Link Values</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">The Custom Link Value that gets passed into eVar1 and prop1 is typically a concatenation of two data attributes, which I put into each element we want to track clicks on:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-noun (represents &ldquo;what&rdquo; is being clicked)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-verb (represents the &ldquo;action&rdquo; the user is taking)</p>
              </li>
            </ul>

            <p class="main__text font_size_body">These two values get concatenated, colon-delimited, and assigned to eVar1 and prop1. For example, if my site had a &ldquo;Careers&rdquo; card containing a &ldquo;Learn More&rdquo; button, that button would contain:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-noun="careers"</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-verb="learn-more"</p>
              </li>
            </ul>

            <p class="main__text font_size_body">(We standardize these values to lowercase kebab-case.) The resulting value passed in eVar1 and prop1 would be <code class="code__snippet">careers:learn-more</code>.</p>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Accordion &lsquo;Open&rsquo; vs. &lsquo;Close&rsquo;</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">Sometimes it gets more complex than this. Maybe there is an FAQ page containing a list of questions. Each question is an accordion that can be opened or closed by clicking on it, and our analysts want to know which is occurring.</p>

            <p class="main__text font_size_body">In this case, I would append a value of &lsquo;open&rsquo; or &lsquo;close&rsquo; to eVar1 and prop1:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">faq:who-installs-your-panels:open</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">faq:who-installs-your-panels:close</p>
              </li>
            </ul>

            <p class="main__text font_size_body">This, too, requires custom logic to only append such a value if the situation calls for it.</p>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Nested AEM Components</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">Even more complex is if the page has AEM components nested inside each other in any order and any combination you might imagine. (See my article on <a class="link link_theme_black" href="adobe-launch-nested-aem-component-click-tracking">Adobe Launch Nested AEM Component Click Tracking</a> for details.)</p>

            <p class="main__text font_size_body">If this is the case, we will have additional attributes such as <code class="code__snippet font_size_body">data-track-component-level-X</code> (with <code class="code__snippet font_size_body">X</code> being a number) to also concatenate prior to the <code class="code__snippet font_size_body">data-track-noun</code> and <code class="code__snippet font_size_body">data-track-verb</code> values:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-component-level-1="employment"</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-noun="research-development"</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">data-track-verb="learn-more"</p>
              </li>
            </ul>

            <p class="main__text font_size_body">Giving us results like: <code class="code__snippet font_size_body">employment:research-development:learn-more</code>.</p>
          
          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Shadow DOM Clicks</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">All of the above needs to work the same way if a user clicks an element inside a shadow DOM. (For example, our global header and footer are each inside a shadow DOM.)</p>

            <p class="main__text font_size_body">As of this writing, Adobe Launch does not detect clicks in shadow DOMs, so I have to simulate those by passing the clicked element into this rule via direct call object.  (See my article on <a class="link link_theme_black" href="adobe-launch-shadow-dom-click-tracking">Adobe Launch Shadow DOM Click Tracking</a> for how this is accomplished.)</p>

            <p class="main__text font_size_body">So, this <code class="code__name">Global | Set Variables | Clicks or Events #25</code> rule needs to be able to take in that object, treat it as if it were a regular clicked element, and then account for all the same use cases listed above.</p>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Direct Call Objects</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">There are some additional use cases for things like adding items to a cart, or updating their quantities, which are handled via direct call. These direct calls often pass an object containing only the custom data that is needed. So in these cases, this rule needs to know how to parse that custom data and standardize it into the Custom Link Value we would normally pass.</p>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Sending and Clearing the Variables</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <p class="main__text font_size_body">One last architectural note before I move on to the syntax of the custom code itself. This <code class="code__name">Global | Set Variables | Clicks or Events #25</code> rule <em>sets</em> the variables, but it does not <em>send and clear</em> them. That function is handled by a separate rule called <code class="code__name">Global | Send, Clear Variables | Clicks or Events #100</code> rule.</p>

            <p class="main__text font_size_body">The <code class="code__name">#25</code> and the <code class="code__name">#100</code> at the end of each rule&rsquo;s name represents the &ldquo;order&rdquo; each one is programmed to fire in. This ensures that the <code class="code__name">#25</code> rule fires first, and the <code class="code__name">#100</code> rule fires second. This also allows us to fire additional custom click tracking rules in between order <code class="code__name">#25</code> and order <code class="code__name">#100</code> so that we can roll some additional data into certain clicks if we want to and include it in the same network call.</p>

            <p class="main__text font_size_body">This means that both rules need to trigger on all the exact same events in order to stay in sync &mdash; with one difference:</p>

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">Both rules listen for clicks on anchor tags.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Both rules listen for clicks on buttons.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">The &ldquo;Set Variables #25&rdquo; listens for the <code class="code__snippet">set-global-click-or-event-variables</code> direct call.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">The &ldquo;Send, Clear Variables #100&rdquo; listens for the <code class="code__snippet">send-global-click-or-event-beacon</code> direct call.</p>
              </li>
            </ul>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->
        
      </section>

      <section>

        <div class="heading heading_theme_black">
          <div class="heading__title-overflow">
            <h2 class="heading__title-tag font_size_3">
              <span class="heading__title-tag_title">Syntax for Custom Link Values</span>
            </h2>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">
            
            <p class="main__text font_size_body">For context, here is the full custom code block. (Scroll past it for a step-by-step explanation of each part.)</p>

  <pre class="code__block"><code class="language-javascript">let ruleTriggerType = event.$type.replace('core.', '');
let clickedElement = '';
let clickedElementAttributes = '';
let clickAttributes = {};
let accordionStatus = '';
const customLinkValues = [];

// The following are used if data-track-verb is missing:
let childNodes = '';
let className = '';
let imgTag = '';
let name = '';
let parentNode = '';

// Helper Functions
function cleanText(_txt) {
  if (!_txt) return;

  let clean = _txt.trim();
  if (!clean) return;

  let removeStr;
  const startPos = (clean.indexOf('<sup>') || clean.indexOf('<sub>'));
  const endPos = (clean.indexOf('</sup>') || clean.indexOf('</sub>')) - startPos + 6;

  if (startPos > -1) {
    removeStr = clean.substr(startPos, endPos);
    clean = clean.split(removeStr).join('');
  }

  clean = clean.replace(/[^a-z\d\s]+/gi, ' ');
  clean = clean.trim();
  clean = clean.replace(/\s{2,}/g, ' ');
  clean = clean.split(' ').join('-').toLowerCase();
  var whSpace = /\s/;
  clean = clean.replace(whSpace, '-');
  return clean;
}

const getLinkName = (_element) => {
  const navName = _element.getAttribute('data-nav-name') || '';
  const navText = _element.getAttribute('data-us-text') || '';
  const navTitle = _element.getAttribute('title') || '';
  const navTitle2 = _element.getAttribute('data-us-title') || '';
  const altTag = _element.getAttribute('alt') || '';
  let elementText = '';

  if (_element.hasAttribute('aria-label')) {
    elementText = _element.getAttribute('aria-label');
  } else {
    elementText = _element.textContent;
  }

  if (altTag === '' || !elementText) {
    if (!elementText) {
      elementText = $(_element).clone().children().remove().end().text() || '';
      if (_element.nextElementSibling) {
        if (_element.nextElementSibling.firstElementChild) {
          elementText = _element.nextElementSibling.firstElementChild.textContent || '';
        }
      }
    }
  }

  let linkName = elementText || navName || navText || altTag || navTitle || navTitle2 || '';
  return linkName;
}

// Initial Standardization for Clicks, Direct Calls, and Shadow DOM Clicks:
switch (ruleTriggerType) {
  case 'click':
  case 'change':
    clickedElement = this;
    s.events = s.apl(s.events, 'event1', ',');
    break;
  case 'direct-call':
    if (!!event && !!event.detail) {
      if (!!event.detail.clickedElement) {
        clickedElement = event.detail.clickedElement;
      }
      if (!!event.detail.shadowClick) {
        ruleTriggerType = 'shadowClick';
        s.events = s.apl(s.events, 'event1', ',');
      }
    }
    break;
}

if (!!clickedElement && !!clickedElement.attributes) {
  clickedElementAttributes = [...clickedElement.attributes];
}

if (!!clickedElementAttributes) {
  clickedElementAttributes.forEach(clickedElementAttribute => {
    const key = clickedElementAttribute.name;
    const value = clickedElementAttribute.value;
    clickAttributes[key] = value;
  });
}

// Post-Standardization Logic:
switch (ruleTriggerType) {
  case 'click':
  case 'shadowClick':
    if (!clickAttributes['data-track-verb']) {
      // If data-track-verb is missing:
      name = 'na';
      className = (clickAttributes.class) ? clickAttributes.class : '';
      childNodes = clickedElement.childNodes;
      parentNode = clickedElement.parentNode;
      imgTag = clickedElement.querySelector('img');

      if (imgTag) name = getLinkName(imgTag) || name;
      if (name === 'na') name = getLinkName(clickedElement) || name;

      if (
        (
          !!className &&
          typeof className === 'string'
        ) &&
        parentNode.parentNode.dataset.track === 'accordion-section'
      ) {
        name = parentNode.parentNode.getAttribute('data-track-verb');
        accordionStatus = clickedElement.getAttribute('aria-expanded') === 'true' ? 'close' : 'open';
      }
      clickAttributes['data-track-verb'] = name;
    }
    break;
  case 'direct-call':
    if (!!event && !!event.detail && !event.detail.clickedElement) {
      if (!!event.detail.trackNoun) {
        clickAttributes['data-track-noun'] = event.detail.trackNoun;
      }
      if (!!event.detail.trackVerb) {
        clickAttributes['data-track-verb'] = event.detail.trackVerb;
      }
    }
    break;
}

// Final cleanup before concatenation occurs:
for (const property in clickAttributes) {
  if (property.includes('data-track')) {
    clickAttributes[property] = cleanText(clickAttributes[property]);
  }
}

// Stage the custom link values in the order they will be concatenated:
let level = 1;
let dataTrackComponentLevelX = '';
do {
  dataTrackComponentLevelX = clickAttributes[`data-track-component-level-${level}`];
  if (!!dataTrackComponentLevelX) {
    customLinkValues.push(dataTrackComponentLevelX);
  }
  level++;
} while (!!clickAttributes[`data-track-component-level-${level}`]);

if (!!clickAttributes['data-track-noun']) {
  customLinkValues.push(clickAttributes['data-track-noun']);
}

if (!!clickAttributes['data-track-verb']) {
  customLinkValues.push(clickAttributes['data-track-verb']);
}

if (!!accordionStatus) {
  customLinkValues.push(accordionStatus); // 'open' vs. 'close'
}

// Then cap each one at 60 characters so we don't go over Adobe's 255-character limit when concatenated:
const cappedLinkValues = customLinkValues.map(customLinkValue => {
  if (customLinkValue.length > 60) {
    customLinkValue = customLinkValue.slice(0, 60);
  }
  return customLinkValue;
});

// Then join the capped link values with colons:
const customLinkValuesConcat = cappedLinkValues.join(':');

s.eVar1 = s.prop1 = customLinkValuesConcat;
s.linkTrackVars = s.apl(s.linkTrackVars, 'eVar1,prop1,events', ',');
s.linkTrackEvents = s.events;</code></pre>

          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

        <div class="heading heading_theme_clear">
          <div class="heading__title-overflow">
            <h3 class="heading__title-tag font_size_2">
              <span class="heading__title-tag_title">Explanation</span>
            </h3>
          </div>
        </div>

        <div class="content__center content__center_700">

          <div class="content__block">

            <ul class="main__list font_size_body">
              <li class="content__block_li">
                <p class="main__text font_size_body">Line 1: I want to know which type of event triggered the rule. The event could be a click, a shadow DOM click, a direct call, a &lsquo;change&rsquo;, etc. This will be used as a starting point to standardize the data coming in. I also strip out the <code class="code__snippet">core.</code> that is always going to be present. (Note that <code class="code__snippet">let</code> is used instead of <code class="code__snippet">const</code> because there will be some manipulation of this value if the event was a shadow DOM click. More on that later.)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 2 - 6: I declare a set of empty variables where certain data will be stored, if certain conditions are later met:</p>
                <ul class="main__list font_size_body">
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 2: For the clicked element (regular or simulated) itself.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 3: Will become an array where <em>all</em> the attributes of the clicked element will be stored.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 4: For the key/value pairs for each attribute after they are converted from the above array.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 5: For the &lsquo;open&rsquo; or &lsquo;close&rsquo; value on an accordion click.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 6: At the end, I will push just the values the anaylists want to track, in the order they want to track them, into this array.</p>
                  </li>
                </ul>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 9 - 13: Declare variables that will be used if the <code class="code__snippet">data-track-verb</code> attribute is missing from the clicked element.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 16 - 38: <code class="code__snippet">cleanText</code> is a helper function that standardizes text to lowercase kebab-case.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 40 - 67: <code class="code__snippet">getLinkName</code> is a helper function that contains fallbacks for getting a click tracking value from other places in the element if the normal <code class="code__snippet">data-track</code> attributes are missing.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 70 - 88: Next, I determine what I want to consider the clicked element to be:</p>
                <ul class="main__list font_size_body">
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 73: If the rule was triggered by a &lsquo;click&rsquo; or a &lsquo;change&rsquo;, the clicked element will be the &lsquo;this&rsquo; keyword.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 74: Since I know this use case means that it should be tracked as a click, I go ahead and increment <code class="code__snippet">event1</code> now.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Lines 78 - 80: If the rule was triggered by a direct call, it may have received an object along with it that I want to treat as the clicked element.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 82: If the rule was triggered by a shadow DOM click, I reassign its <code class="code__snippet">ruleTriggerType</code> value to <code class="code__snippet">shadowClick</code> so that I can differentiate between the two in my logic later.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Line 83: And if this event <em>was</em> a shadow DOM click, I can also go ahead and increment <code class="code__snippet">event1</code> now.</p>
                  </li>
                </ul>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 89 - 91: Now that I&rsquo;ve determined what I want to use as my clicked element, I can pull the attributes from it and store them in an array. (The validation is necessary because <code class="code__snippet">clickedElement.attributes</code> will not work if a direct call passed a custom object into this rule containing only the specific data that is needed. That use case will be accounted for later.)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 93 - 99: Convert the array of attributes into key/value pairs and store them in the <code class="code__snippet">clickAttributes</code> object. (This is the format that will be used for the rest of the rule.) Once again, validation is necessary in case the object passed into this rule does not contain architecture consistent with that of a clicked element.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 103 - 114: If the event was triggered by either a regular click or a shadow DOM click, and if the clicked element is missing the <code class="code__snippet">data-track-verb</code> attribute, fallback logic is used to source a value from other attributes instead.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 116 - 125: If the clicked element is an accordion, the accordion status is set to either &lsquo;open&rsquo; or &lsquo;close&rsquo; based on the <code class="code__snippet">aria-expanded</code> attribute.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Line 126: In the end, I store the fallback value in the <code class="code__snippet">clickAttributes</code> object&rsquo;s <code class="code__snippet">data-track-verb</code> property.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 129 - 138: If the rule was triggered by a direct call with a custom object passed into it, I look specifically for those custom properties here.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 142 - 147: Finally, the <code class="code__snippet">clickAttributes</code> object contains all the key/value pairs it&rsquo;s going to get. The properties that will ultimately be passed to Adobe Analytics start with <code class="code__snippet">data-track</code>. Those are the only ones I need to convert to lowercase kebab-case. (And I do need to do this in case some of these values were indeed pulled from fallbacks such as link text, alt tags, aria-labels, etc. They could include special characters, spaces, capital letters, and more.)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 149 - 169: Now that all of the tracking values have been standardized to lowercase kebab-case, it is time to stage them in the order that they will be concatenated and passed to Adobe Analytics in eVar1 and prop1. This is done by simply pushing them into an array in the desired order:</p>
                <ul class="main__list font_size_body">
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Lines 149 - 157: That means I stage all the <code class="code__snippet">data-track-component-level-1</code>, <code class="code__snippet">2</code>, <code class="code__snippet">3</code>, etc. values first, and in numerical order. But I have no way of knowing how many there will be, or if there will even be any at all. (This use case will only apply if there are AEM components on the page. See my article on <a class="link link_theme_black" href="adobe-launch-nested-aem-component-click-tracking">Adobe Launch Nested AEM Component Click Tracking</a> for full details.) Therefore, I use a <code class="code__name">do while</code> loop.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Lines 159 - 161: If there is a <code class="code__snippet">data-track-noun</code> value, I stage that next.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Lines 163 - 165: If there is a <code class="code__snippet">data-track-verb</code> value, I stage that next.</p>
                  </li>
                  <li class="content__block_li">
                    <p class="main__text font_size_body">Lines 167 - 169: Lastly, if this was an accordion click, I stage either <code class="code__snippet">open</code> or <code class="code__snippet">close</code>.</p>
                  </li>
                </ul>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 172 - 177: Adobe has a 255-character limit, and my concatenation could potentially get pretty long. (Especially if there are a lot of layers of nested components, or if the text from an anchor tag was used as a fallback.) If the custom link tracking value goes over 255 characters, Adobe will truncate it. I'd rather control how that truncation occurs, so I cap each individual value at 60 characters. (The ballpark estimation is that our site will likely not have more than four layers of nested components &mdash; plus perhaps an &lsquo;open&rsquo; or &lsquo;close&rsquo; appendage at the end if this was an accordion click.)</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Line 180: Finally, the actual concatenation is done by joining the items in the array with colons.</p>
              </li>
              <li class="content__block_li">
                <p class="main__text font_size_body">Lines 182 - 184: Assign all the values to their respective places in Adobe&rsquo;s <code class="code__snippet">s</code> object.</p>
              </li>
            </ul>
              
          </div> <!-- Close .content__block -->

        </div> <!-- Close .content__center content__center_700 -->

      </section>
    
    </main>

    <footer class="footer footer_theme_black">

      <div class="center__1140">
      
        <div class="footer__icon-row">

          <div class="footer__icon">
            <a href="/" class="footer__icon_link">
              <div class="footer__icon_link-content">
                <i class="fas fa-home footer__icon_icon"></i>
                <p class="footer__icon_text font_size_body">Home</p>
              </div>
            </a>
          </div>

          <div class="footer__icon">
            <a href="https://www.github.com/toddcf" target="_blank" class="footer__icon_link">
              <div class="footer__icon_link-content">
                <i class="fab fa-github footer__icon_icon"></i>
                <p class="footer__icon_text font_size_body">GitHub</p>
              </div>
            </a>
          </div>

          <div class="footer__icon">
            <a href="https://www.linkedin.com/in/toddcf" target="_blank" class="footer__icon_link">
              <div class="footer__icon_link-content">
                <i class="fab fa-linkedin footer__icon_icon"></i>
                <p class="footer__icon_text font_size_body">LinkedIn</p>
              </div>
            </a>
          </div>

          <div class="footer__icon">
            <a href="resume_todd_croak-falen.pdf" target="_blank" class="footer__icon_link">
              <div class="footer__icon_link-content">
                <i class="fas fa-file-alt footer__icon_icon"></i>
                <p class="footer__icon_text font_size_body">Résumé</p>
                <p class="footer__icon_text font_size_body">(PDF with contact info)</p>
              </div>
            </a>
          </div>
          
        </div> <!-- Close .footer-icon__row -->

        <div class="footer__copyright">
          <p class="footer__copyright_text font_size_body">&copy; Copyright 2016 <span class="currentYear"></span>Todd Croak-Falen</p>
        </div>

      </div> <!-- Close .center__1140 -->

    </footer>

  </div> <!-- Close .body__project-container -->

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

  <!-- Waypoints -->
  <script src="../assets/js/jquery.waypoints.min.js"></script>

  <!-- Prism -->
  <script src="../assets/prism/prism-okaidia-1.29.0.js"></script>
  
  <!-- Custom JavaScript -->
  <script src="../assets/js/global.js"></script>
  <script src="../assets/js/footer-min.js"></script>

</body>

</html>